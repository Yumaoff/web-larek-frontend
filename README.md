# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Продукт

```
export interface IProduct {
  id: number;
  title: string;
  description: string;
  category: string;
  price: number | null;
  imageUrl: string;
  index: number;
}
```

Заказ

```
export interface IOrder {
  id: number;
  email: string;
  phone: string;
  items: CartItem[];
  total: number;
  address: string;
  paymentMethod: string;
}
```

Товар в корзине

```
export interface CartItem {
  productId: number;
  quantity: number;
}
```

Интерфейс корзины 
```
export interface IBasket {
  products: HTMLElement[];
  total: number | null;
  selected: number
}
```

Интерфейс данных после отправки заказа на сервер

```
export interface IOrderResult {
  id: string
  total: number
}
```

Интерфейс ответа сервера

```
interface IApi {
  getProducts: () => Promise<IProduct[]>
  orderProducts(order: IOrder): Promise<IOrderResult>
}
```

Тип для установки метода API

```
export type TApiPostMethods = 'POST' | 'PUT' | 'DELETE';
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), в которой презентер связан как с моделью, так и с отображением данных, но они ничего не знают друг о друге:

- слой представление, который отвечает за отображение данных на странице,
- слой данных, который отвечает за хранение и отправление данных на сервер,
- презентер, отвечающий за связь первых двух слоев (то есть слоев представления и данных)

### Базовый код

#### Класс API

Реализует основную логику для выполнения запросов к серверу. В конструктор передаются базовый URL сервера и необязательные параметры для заголовков запросов. 

Методы: 

- `handleResponse(response: Response)` - обрабатывает ответ от сервера, возвращая промис с данными в случае успешного запроса, или промис с ошибкой в случае неудачи.

- `get` - выполняет GET-запрос на указанный эндпоинт и возвращает промис с ответом от сервера в виде объекта.

- `post` - отправляет данные в формате JSON на указанный эндпоинт, выполняя по умолчанию POST-запрос. Тип запроса можно изменить, передав его в качестве третьего параметра. Возвращает промис с ответом от сервера.

#### Класс EventEmitter
Класс EventEmitter выступает в роли посредника для управления событиями в системе. Он позволяет подписываться на события и инициировать их, что используется презентером для обработки событий и другими слоями приложения для их генерации.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - позволяет подписаться на конкретное событие.
- `emit` - инициирует событие, передавая данные подписчикам.
- `trigger` - возвращает функцию, которая, при вызове, инициирует указанное событие.

Также в классе реализованы следующие дополнительные методы:
- `onAll` -  позволяет прослушивать все события.
- `offAll` - удаляет все зарегистрированные обработчики событий.

#### Базовый Класс Component <T>
Класс Component является базовым для всех представлений. Он поддерживает дженерики и в конструкторе принимает HTML-элемент, который будет наполняться данными из модели.

`constructor (element: HTMLElement)` -  конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента

Основные методы: 

- `toggleClass(element: HTMLElement, className: string, force?: boolean)` - переключает класс у элемента. Параметры: HTML-элемент, класс для переключения, опциональный булевый параметр для принудительного включения или выключения класса.
- `setText(element: HTMLElement, value: unknown)` - устанавливает текстовое содержимое элемента.
- `setDisabled(element: HTMLElement, state: boolean)` - устанавливает или убирает атрибут disabled у элемента. Параметры: HTML-элемент, булевый флаг, который определяет, будет ли атрибут установлен или снят.
- `setHidden(element: HTMLElement)` - скрывает элемент, устанавливая ему соответствующие стили.
- `setVisible(element: HTMLElement)` - делает элемент видимым, убирая стили скрытия.
- `setImage(element: HTMLImageElement, src: string, alt?: string)` - задает изображение для элемента и альтернативный текст (если указан).
- `render(data?: Partial<T>): HTMLElement` - рендерит элемент с переданными данными. Принимает опциональный параметр data, который может содержать частичные данные типа T.

#### Базовый класс Model
Базовый класс модели данных, работает с дженериками.

`constructor(data: Partial<T>, protected events: IEvents)` - принимает частичные данные типа T и экземпляр интерфейса IEvents для управления событиями.

Методы: 

- `emitChanges(event: string, payload?: object)` - уведомляет об изменении модели, инициируя указанное событие с опциональными данными (payload).

### Слой данных

#### Класс AppData

Класс отвечает за хранение данных приложения \
Расширяет класс Model
Все поля приватные, доступ через методы \
В полях класса хранятся следующие данные:

- `products: IProduct[]` - массив объектов продуктов.
- `basket: IProduct[]` - массив товаров в корзине.
- `order: IOrder` - текущий заказ.
- `selectedProduct: string | null` - ID товара, выбранного для отображения в модальном окне.

Методы для работы с данными:

- `setProducts` - устанавливает список товаров для главной страницы.
- `selectProduct` - выбирает продукт для отображения в модальном окне.
- `addProductToBasket` - добавляет товар в корзину.
- `removeProductFromBasket` - удаляет товар из корзины по его ID.
- `getBasketProducts` - возвращает массив товаров в корзине.
- `getTotalPrice` - возвращает общую стоимость товаров в корзине.
- `clearBasket` - очищает корзину.
- `clearOrder` - очищает текущий заказ.
- `setOrderField` - устанавливает значение для поля в заказе.
- `validateOrder` - валидирует поля заказа.

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных. 

